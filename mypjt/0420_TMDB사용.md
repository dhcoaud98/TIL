# TMDB 

## 데이터를 요청하고, 응답 받기!

<br>

### 1. popular_count

```python
import requests  # 요청하기 위해 import 하기
from pprint import pprint

def popular_count():
	
    # 사용하고자 하는 urls 주소 풀러오기!
    URL = 'https://api.themoviedb.org/3/movie/popular'
    params = {
        'api_key': '#'
    }
	
    # response 인스턴스에 요청 받은 파일을 json()으로 받아서 넣기
    response = requests.get(URL, params=params).json()
    
    # 딕셔너리 형태의 response에서 results의 value 값의 길이를 출력하기
    return(len(response.get('results')))
    

if __name__ == '__main__':
    
    print(popular_count())
    # => 20
```

<br>

### 2. vote_average_movies

```python
import requests
from pprint import pprint


def vote_average_movies():
    
    # URL 주소 불러오기
    URL = 'https://api.themoviedb.org/3/movie/popular'
    
    # 투표 결과를 사용 하기 위해서 필수 파라미터 넣어주기
    params = {
        'api_key': '#'
    }
    
	# 응답 받기
    response = requests.get(URL, params=params).json()

    # response 값 중 key가 'results'인 값들만 뽑아 data에 넣음.
    # data의 값은 딕셔너리이다. 
    # data = [['title': , 'vote_average':8, '': , ':' , ...],[],[],[], ...] 
    data = response.get('results')
    
	# popular한 영화의 정보를 담을 new_list 생성
    new_list = []
    
    # for문을 통해 'vote_average'의 값이 8이상일 경우 new_list에 append한다. 
    for i in range(len(data)):
        if data[i]['vote_average'] >= 8:
            new_list.append(data[i])

    return new_list


if __name__ == '__main__':
    """
    popular 영화목록중 vote_average가 8 이상인 영화목록 출력.
    """
    pprint(vote_average_movies())
    # => 영화정보 순서대로 출력

```

<br>

### 3. ranking

```python
import requests
from pprint import pprint


def ranking():

    ### 1
    # URL 주소 불러오기
    URL = 'https://api.themoviedb.org/3/movie/popular'
    params = {
        'api_key': '#'
    }
	
    # 응답 json()파일로 받기
    response = requests.get(URL, params=params).json()

    # response 값 중 key가 'results'인 값들만 뽑아 data에 넣음.
    # data의 값은 list이다. 
    data = response.get('results')
  

    ### 2 
    # 영화별 'vote_avergae' 값만을 나열하여 상위 5개의 값만 list화 한다. 
    new = []
    for i in range(len(data)):
        new.append(data[i]['vote_average']) 

    # 상위 5번째의 점수만 뽑아 rank5로 만든다.  
    rank5 = sorted(new, reverse=True)[:5]
    print(rank5)

    ### 3
	# popular한 영화의 정보를 담을 new_list 생성
    new_list = []
    
    # for문을 통해 'vote_average'의 값이 rank5 = 7.8 보다 크거나 같으면 new_list에 append 한다. 
    for i in range(len(data)):
        if data[i]['vote_average'] >= rank5:
            new_list.append(data[i])

    return new_list

if __name__ == '__main__':
    """
    popular 영화목록을 정렬하여 평점순으로 5개 영화.
    """
    pprint(ranking())
    # => 영화정보 순서대로 출력
```

<br>

### 4. recommendation

```python
import requests
from pprint import pprint


def recommendation(title):

    ### 1
    # title로 movie search 하기
    BASE_URL = 'https://api.themoviedb.org/3/search/movie'
    params = {
        'api_key': '#',
        'query' : title,
        'language' : 'ko'
    }

	# 응답 json() 파일로 받기
    response = requests.get(BASE_URL, params=params).json()
    
    a = response.get('results')

    # 검색 영화의 id값을 list로 만들기
    movie_id = []
    for i in range(len(a)):

        movie_id.append(a[i]['id']) 



    # ### 2
    # search한 영화마다 id의 갯수가 다르기 때문에 for문을 통해 URL의 {movie_id}에 id값을 넣어주며 반복함.
    # movie_id에 해당하여 추천하는 영화의 정보를 b에 담음.
    for i in movie_id:

        URL = f'https://api.themoviedb.org/3/movie/{i}/recommendations'
        params = {
            'api_key': '#', 
            'language' : 'ko'
        }

        response2 = requests.get(URL, params=params).json()
        b = response2.get('results')

        # 추천받은 영화 정보에서 'title'만 추출하여 new_list에 담음.
        new_list = []
    
        for j in range(len(b)):
            new_list.append(b[j]['title'])
            
        return new_list




if __name__ == '__main__':
    """
    제목에 해당하는 영화가 있으면
    해당 영화의 id를 기반으로 추천 영화 목록 구성.
    추천 영화가 없을 경우 [].
    영화 id검색에 실패할 경우 None.
    """
    pprint(recommendation('기생충'))
    ['조커', '조조 래빗', '1917', ..., '토이 스토리 4', '스파이더맨: 파 프롬 홈']
    pprint(recommendation('그래비티'))
    # []  => 추천 영화 없음
    pprint(recommendation('검색할 수 없는 영화'))
    # => None
```

<br>

### 5. credits

```python
import requests
from pprint import pprint


def credits(title):
    
    ## 1
    # title로 movie search 하기
    BASE_URL = 'https://api.themoviedb.org/3/search/movie'
    params = {
        'api_key': '#',
        'query' : 'title',
        'region' : 'KR',
        'language' : 'ko'
    }

    # 요청받은 데이터를 .json()으로 받는다. 
    response = requests.get(BASE_URL, params=params).json()
    
    # 요청받은 데이터에서 results에 해당하는 value값을 a에 넣기
    a = response.get('results')

    # 검색 영화의 id값을 list로 만들기
    movie_id = []
    for i in range(len(a)):

        movie_id.append(a[i]['id']) 

    ## 2
    # search한 영희마다 id의 갯수가 다르기 때문에 for문을 통해 URL의 {movie_id}에 id값을 넣어주며 반복함.
    # movie_id에 해당하는 영화의 credits 값을 받음.
    for i in movie_id:

        URL = f'https://api.themoviedb.org/3/movie/{i}/credits'
        params = {
            'api_key': '11fca68c2a4afa584e0c7704a48f54d3', 
            'language' : 'ko',
            'region' : 'KR',
        }

        response2 = requests.get(URL, params=params).json()
        b = response2.get('cast')
        
        # 변수 초기화
        new_dict = {}
        new1 = []
        new2 = []
        
        # 추천받은 영화 정보에서 cast_id 값이 10보다 작은 배우의 이름을 리스트에 저장한다./ Directing의 이름을 리스트에 저장한다. 
        for i in range(len(b)):
            if b[i]['cast_id'] < 10:
                new1.append(b[i]['name'])
            if b[i]['known_for_department'] == 'Directing' :
                new2.append(b[i]['name'])

        # key와 value 값을 dictionary로 출력
        new_dict['cast'] = new1
        new_dict['crew'] = new2
        return new_dict
            
if __name__ == '__main__':
    """
    제목에 해당하는 영화가 있으면
    해당 영화 id를 통해 영화 상세정보를 검색하여
    주연배우 목록(cast)과 제작진(crew).
    영화 id검색에 실패할 경우 None.
    """
    pprint(credits('기생충'))
    # => {'cast': ['Song Kang-ho', 'Lee Sun-kyun', ..., 'Jang Hye-jin'], 'crew': ['Bong Joon-ho', 'Park Hyun-cheol', ..., 'Yoon Young-woo']}
    pprint(credits('검색할 수 없는 영화'))
    # => None

```

